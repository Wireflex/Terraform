Суть в том, чтобы не хранить код VPC,SG,EC2 в 1 файле и при изменении 1ого не проверять все остальные, поэтому раскидываем их по разным директориям, ну и так удобнее вроде как

Для того, что связать их между собой - храним состояние в s3 (+dynamodb для блока) и связываем через data и outputs (можно вручную кэш прописывать айди vpc и sg, но эт пздц)

Изначально комментируем backend s3 в начале backend/main.tf, чтобы создать локально, далее создаём S3 - DynamoDB из "backend"

Далее VPC - SG - EC2 из соответствующих директорий

Удаляем в обратном порядке, terraform будет подсказывать
